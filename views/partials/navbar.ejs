<nav
  class="navbar sticky-top navbar-expand-md bg-nav-chem"
  role="navigation"
>
  <div class="container-md">
    <a class="navbar-brand fs-4" href="/"> ChemKey </a>
    <button
      class="navbar-toggler"
      type="button"
      data-bs-toggle="collapse"
      data-bs-target="#navbarNav"
      aria-controls="navbarNav"
      aria-expanded="false"
      aria-label="Toggle navigation"
    >
      <span class="navbar-toggler-icon"></span>
    </button>
    <div
      class="collapse navbar-collapse justify-content-between"
      id="navbarNav"
    >
      <ul class="navbar-nav">
        <li class="nav-item">
          <a class="nav-link <%= (locals.currentPage === 'home') ? 'active' : '' %>" href="/#home">Home</a>
        </li>
        <li class="nav-item">
          <a class="nav-link <%= (locals.currentPage === 'features') ? 'active' : '' %>" href="/#features">Features</a>
        </li>
        <li class="nav-item">
          <a class="nav-link <%= (locals.currentPage === 'pricing') ? 'active' : '' %>" href="/#pricing">Pricing</a>
        </li>
        <li class="nav-item">
          <a class="nav-link <%= (locals.currentPage === 'about') ? 'active' : '' %>" href="/#about">About Us</a>
        </li>
        <% if (!locals.isLoggedIn) { %>
          <li class="nav-item">
            <a class="nav-link <%= (locals.currentPage === 'login') ? 'active' : '' %>" href="/login">Login</a>
          </li>
          <li class="nav-item">
            <a class="nav-link <%= (locals.currentPage === 'register') ? 'active' : '' %>" href="/register">Register</a>
          </li>
        <% } else { %>
          <li class="nav-item">
            <a class="nav-link <%= (locals.currentPage === 'app') ? 'active' : '' %>" href="/app">My Vault</a>
          </li>
        <% } %>
      </ul>

      <% if (locals.isLoggedIn && locals.user) { %>
        <div class="d-flex align-items-center">
          <span class="navbar-text me-3">
            Welcome, <%= locals.user.name || locals.user.username || 'User' %>
          </span>
          <button id="logout-btn" class="btn btn-outline-dark btn-sm">
            <i class="fa fa-sign-out"></i> Logout
          </button>
        </div>
      <% } %>
    </div>
  </div>
</nav>

<% if (locals.isLoggedIn) { %>
<script>
// Logout functionality
document.getElementById('logout-btn')?.addEventListener('click', async function() {
  try {
    const response = await fetch('/auth/logout', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
    });

    const result = await response.json();

    if (result.success) {
      window.location.href = result.redirectUrl || '/';
    } else {
      alert('Error while logging out: ' + result.error);
    }
  } catch (error) {
    console.error('Error:', error);
    alert('Erro ao fazer logout. Tente novamente.');
  }
});
</script>
<% } %>
